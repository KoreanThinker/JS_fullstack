# Migration `20201113045744-init`

This migration has been generated by hyun at 11/13/2020, 1:57:44 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE `Partner` (
`id` int  NOT NULL  AUTO_INCREMENT,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`email` varchar(191)  NOT NULL ,
`password` varchar(191)  NOT NULL ,
`name` varchar(191)  NOT NULL ,
`profit` int  NOT NULL DEFAULT 0,
UNIQUE INDEX `Partner.email_unique`(`email`),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `Order` (
`id` int  NOT NULL  AUTO_INCREMENT,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
`price` int  NOT NULL ,
`itemState` ENUM('receiving', 'receiptCompleted', 'deliveryProgress', 'deliveryCompleted', 'canceled', 'confirmation')  NOT NULL DEFAULT 'receiving',
`buyerId` int  ,
`itemId` int  ,
`partnerId` int  ,
`waybillNumber` varchar(191)  ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `Item` (
`id` int  NOT NULL  AUTO_INCREMENT,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
`published` boolean  NOT NULL DEFAULT true,
`partnerId` int  ,
`price` int  NOT NULL ,
`name` varchar(191)  NOT NULL ,
`orderCount` int  NOT NULL DEFAULT 0,
UNIQUE INDEX `Item.name_unique`(`name`),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `Option` (
`id` int  NOT NULL  AUTO_INCREMENT,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
`itemId` int  NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `OptionItem` (
`id` int  NOT NULL  AUTO_INCREMENT,
`name` varchar(191)  NOT NULL ,
`price` int  NOT NULL ,
`optionId` int  NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `CartItem` (
`id` int  NOT NULL  AUTO_INCREMENT,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
`quantity` int  NOT NULL ,
`itemId` int  NOT NULL ,
`userId` int  ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `Image` (
`id` int  NOT NULL  AUTO_INCREMENT,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`src` varchar(191)  NOT NULL ,
`itemId` int  ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `User` (
`id` int  NOT NULL  AUTO_INCREMENT,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`email` varchar(191)  NOT NULL ,
`sns` ENUM('em', 'ka', 'fa', 'go', 'na')  NOT NULL ,
`password` varchar(191)  ,
`name` varchar(191)  NOT NULL ,
UNIQUE INDEX `User.email_unique`(`email`),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `SearchKeyword` (
`id` int  NOT NULL  AUTO_INCREMENT,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`keyword` varchar(191)  NOT NULL ,
`userId` int  ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `_CartItemToOptionItem` (
`A` int  NOT NULL ,
`B` int  NOT NULL ,
UNIQUE INDEX `_CartItemToOptionItem_AB_unique`(`A`,
`B`),
INDEX `_CartItemToOptionItem_B_index`(`B`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

ALTER TABLE `Order` ADD FOREIGN KEY (`itemId`) REFERENCES `prisma`.`Item`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `Order` ADD FOREIGN KEY (`buyerId`) REFERENCES `prisma`.`User`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `Order` ADD FOREIGN KEY (`partnerId`) REFERENCES `prisma`.`Partner`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `Item` ADD FOREIGN KEY (`partnerId`) REFERENCES `prisma`.`Partner`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `Option` ADD FOREIGN KEY (`itemId`) REFERENCES `prisma`.`Item`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `OptionItem` ADD FOREIGN KEY (`optionId`) REFERENCES `prisma`.`Option`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `CartItem` ADD FOREIGN KEY (`itemId`) REFERENCES `prisma`.`Item`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `CartItem` ADD FOREIGN KEY (`userId`) REFERENCES `prisma`.`User`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `Image` ADD FOREIGN KEY (`itemId`) REFERENCES `prisma`.`Item`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `SearchKeyword` ADD FOREIGN KEY (`userId`) REFERENCES `prisma`.`User`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `_CartItemToOptionItem` ADD FOREIGN KEY (`A`) REFERENCES `prisma`.`CartItem`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_CartItemToOptionItem` ADD FOREIGN KEY (`B`) REFERENCES `prisma`.`OptionItem`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201113045744-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,125 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "mysql"
+  url = "***"
+}
+
+model Partner {
+  id        Int      @id @default(autoincrement())
+  createdAt DateTime @default(now())
+  email     String   @unique
+  password  String
+  name      String
+  profit    Int      @default(0)
+  items     Item[]
+  orders    Order[]
+}
+
+model Order {
+  id            Int       @id @default(autoincrement())
+  createdAt     DateTime  @default(now())
+  updatedAt     DateTime  @updatedAt
+  price         Int
+  itemState     ItemState @default(receiving)
+  item          Item?     @relation(fields: [itemId], references: [id])
+  buyer         User?     @relation(fields: [buyerId], references: [id])
+  partner       Partner?  @relation(fields: [partnerId], references: [id])
+  buyerId       Int?
+  itemId        Int?
+  partnerId     Int?
+  waybillNumber String?
+}
+
+model Item {
+  id         Int        @id @default(autoincrement())
+  createdAt  DateTime   @default(now())
+  updatedAt  DateTime   @updatedAt
+  published  Boolean    @default(true)
+  partner    Partner?   @relation(fields: [partnerId], references: [id])
+  partnerId  Int?
+  order      Order[]
+  price      Int
+  name       String     @unique
+  images     Image[]
+  CartItem   CartItem[]
+  options    Option[]
+  orderCount Int        @default(0)
+}
+
+model Option {
+  id          Int          @id @default(autoincrement())
+  createdAt   DateTime     @default(now())
+  updatedAt   DateTime     @updatedAt
+  optionItems OptionItem[]
+  item        Item         @relation(fields: [itemId], references: [id])
+  itemId      Int
+}
+
+model OptionItem {
+  id        Int        @id @default(autoincrement())
+  name      String
+  price     Int
+  option    Option     @relation(fields: [optionId], references: [id])
+  optionId  Int
+  cartItems CartItem[]
+}
+
+model CartItem {
+  id             Int          @id @default(autoincrement())
+  createdAt      DateTime     @default(now())
+  updatedAt      DateTime     @updatedAt
+  quantity       Int
+  item           Item         @relation(fields: [itemId], references: [id])
+  itemId         Int
+  currentOptions OptionItem[]
+  User           User?        @relation(fields: [userId], references: [id])
+  userId         Int?
+}
+
+model Image {
+  id        Int      @id @default(autoincrement())
+  createdAt DateTime @default(now())
+  src       String
+  item      Item?    @relation(fields: [itemId], references: [id])
+  itemId    Int?
+}
+
+model User {
+  id                   Int             @id @default(autoincrement())
+  createdAt            DateTime        @default(now())
+  email                String          @unique
+  sns                  SnsLogin
+  password             String?
+  name                 String
+  orders               Order[]
+  cart                 CartItem[]
+  recentSearchKeywords SearchKeyword[]
+}
+
+model SearchKeyword {
+  id        Int      @id @default(autoincrement())
+  createdAt DateTime @default(now())
+  keyword   String
+  User      User?    @relation(fields: [userId], references: [id])
+  userId    Int?
+}
+
+enum SnsLogin {
+  em
+  ka
+  fa
+  go
+  na
+}
+
+enum ItemState {
+  receiving
+  receiptCompleted
+  deliveryProgress
+  deliveryCompleted
+  canceled
+  confirmation
+}
```


